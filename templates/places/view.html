{% extends 'base.html' %}

{% block content %}
<h1>{{place.name}}</h1>

<p>
	Address: {{place.address}} - {{place.city.zipcode}} <a href="{% url city-view place.city.slug %}">{{place.city.name}}</a>
</p>
<p>
	Created by {{place.creator}} on {{place.created|date('d-m-Y H\hi')}}
</p>

<h2>Map</h2>
{% with place.get_point() as point %}
{% if point %}
<div id="map" style="width: 100%; height: 180px"></div>
{% if user.is_authenticated() %}
	<a class="btn btn-success" href="{% url place-map place.id %}">Edit the map</a>
{% endif %}

<script type="text/javascript">
var map = new L.Map('map');

// create the tile layer with correct attribution
var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
var osmAttrib='Map data Â© OpenStreetMap contributors';
var osm = new L.TileLayer(osmUrl, {minZoom: 8, maxZoom: 14, attribution: osmAttrib});		

// start the map in Paris
var place = new L.LatLng({{point[0]}}, {{point[1]}});

map.setView(place, 13);
map.addLayer(osm);

var marker = new L.Marker(place);
map.addLayer(marker);

</script>

{% else %}
	{% if user.is_authenticated() %}
	<a class="btn btn-warning" href="{% url place-map place.id %}">Create the map</a>
	{% else %}
	<p class="alert alert-info">No map yet for this place</p>
	{% endif %}
{% endif %}
{% endwith %}

<h2>Subways</h2>
{% if place.subways.count() > 0 %}
<ul>
	{% for subway in place.subways.all() %}
	<li>
		{{subway.name}}
		{% for line in subway.lines.all() %}
			<img src="/medias/img/subways/ligne_{{line.name}}.png" />
		{% endfor %}
	</li>
	{% endfor %}
</ul>
{% else %}
<p class="alert alert-warning">No subways</p>
{% endif %}
<h2>Products</h2>

{% if prices %}
<ul>
{% for price in prices %}
	<li><a href="{% url product-price price.product.id, place.id %}">{{price.product.name}}</a> @ {{price.price}} euros by {{price.creator}}</li>
{% endfor %}
</ul>
{% else %}
No prices
{% endif %}

{% if user.is_authenticated() %}
<ul id="products_tab" class="nav nav-tabs">
{% for cat in categories %}
<li {% if loop.first %}class="active"{% endif %}><a href="#cat_{{cat.id}}" data-toggle="tab">{{cat.name}}</a></li>	
{% endfor %}
</ul>

   <div id="products_content" class="tab-content">
{% for cat in categories %}
<div class="tab-pane fade {% if loop.first %}in active{% endif %}" id="cat_{{cat.id}}">
	{% for product in cat.products.all().order_by('name') %}
	<a class="product" href="{% url product-price product.id, place.id %}" id="product_{{product.id}}">
		{{product.name|truncatechars(15)}}
	</a>
	{% else %}
	<p class="alert alert-error">No products</p>
	{% endfor %}
</div>
{% endfor %}
</div>

{% endif %}

{% endblock %}